# MoveNet + YOLOv8 人物與物品互動識別程式

這是一個結合了 **YOLOv8** 和 **MoveNet** 兩個深度學習模型的 Python 應用程式，旨在透過視訊鏡頭，即時識別**人物與其手中物品的互動關係**。

## 程式目標

本程式的主要目標是利用 YOLOv8 偵測畫面中的「人物」和「物品」，並結合 MoveNet 分析人物的「手腕」姿態，最終判斷出人物是否正在**持有**某個物品。

## 核心元件

1.  **YOLOv8 (`yolov8n.pt`)**:
    *   **作用**：物件偵測與追蹤。
    *   **說明**：在此程式中，它透過 `track` 函式，不僅能從視訊畫面中快速找出所有「人物」和我們感興趣的「物品」，還能**穩定地追蹤**每個偵測到的人物。這有助於在連續的影像幀中，讓偵測結果更加穩定、避免閃爍。
    *   **可辨識物品**：`cell phone` (手機), `handbag` (手提包), `suitcase` (行李箱), `backpack` (後背包), `teddy bear` (泰迪熊), `bottle` (瓶子), `umbrella` (雨傘)。
    *   **信心度閾值**：只會考慮信心度大於 **0.25** 的偵測結果。

2.  **MoveNet (`movenet_lightning.tflite`)**:
    *   **作用**：姿態估計 (Pose Estimation)。
    *   **說明**：在 YOLOv8 偵測到人物後，程式會先對該人物進行一次**優化裁切**（見下方運作流程說明），然後交給 MoveNet 分析該人物的身體姿態，並精確找出其 17 個身體關鍵點（如「左手腕」和「右手腕」）。
    *   **信心度閾值**：只會考慮信心度大於 **0.3** 的關鍵點。

## 運作流程

程式的運作流程如下：

1.  **載入模型**：程式啟動時，會先將預先下載好的 YOLOv8 和 MoveNet 模型載入到記憶體中。
2.  **開啟視訊鏡頭**：成功載入模型後，程式會開啟電腦的預設視訊鏡頭。
3.  **逐幀處理**：
    *   程式會不斷地從鏡頭讀取畫面（影格）。
    *   對於每一幀畫面，程式會：
        1.  使用 **YOLOv8 的 `track` 功能**偵測並追蹤畫面中的所有物件，以獲得更穩定的結果。
        2.  對於每一個偵測到的人物：
            *   **[優化] 預處理**：為了提高 MoveNet 的準確率，程式會以人物的中心點為基準，裁切出一個**保持原始長寬比**的方形區域。這能避免影像變形對姿態估計造成的影響。
            *   將裁切後的影像送入 **MoveNet**，獲取其身體的 17 個關鍵點。
        3.  **計算物品與手腕的距離**：檢查是否有任何「物品」的中心點，靠近該人物的「左手腕」或「右手腕」關鍵點。
        4.  **判斷互動**：如果物品與手腕的距離小於一個**動態計算**的閾值，則判斷為「持有」互動。
        5.  **視覺化**：在畫面上繪製物件邊界框、人物骨架，並將判斷出的互動結果（例如 `Holding: cell phone`）顯示出來。
4.  **顯示畫面**：程式會開啟一個視窗，即時顯示處理後的視訊畫面。
5.  **結束程式**：當使用者在視窗開啟時按下 `q` 鍵，程式會停止運作，並關閉所有視窗。

## 人物物品互動判斷

程式目前的核心功能是判斷「持有」(Holding) 互動。

*   **判斷邏輯**：
    1.  找出畫面上所有的人物和我們感興趣的物品。
    2.  對每個人物，取得其左右手腕的精確像素座標（前提是手腕關鍵點的信心度 > 0.3）。
    3.  對每個物品，計算其邊界框的中心點座標。
    4.  計算每個手腕與每個物品中心點之間的**歐幾里得距離**。
    5.  如果該距離小於一個**動態閾值**，程式就會認定此人正在持有該物品。這個動態閾值是根據**人物邊界框寬度的 20% (`person_width * 0.2`)** 來計算的，這讓判斷能適應不同遠近的人物，更具彈性。

## 如何使用

1.  確保所有必要的 Python 函式庫（如 `opencv-python`, `tensorflow`, `ultralytics`）都已安裝。
2.  運行 `MoveNet.py` 腳本。
3.  一個標題為 `MoveNet + YOLOv8 Action Recognition` 的視窗將會彈出。
4.  **在鏡頭前，嘗試拿起您的手機、瓶子、雨傘或後背包**，觀察程式是否能在您的頭像旁邊顯示對應的 `Holding: ...` 字樣。
5.  若要關閉程式，請點選該視窗並按下鍵盤上的 `q` 鍵。

---

## 附錄：MoveNet 模型版本選擇
